defmodule ElixiconTest do
  use ExUnit.Case
  doctest Elixicon

  test "render_image returns the correct binary" do
    image_binary = <<137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 0, 250, 0, 0, 0, 250, 8, 2, 0, 0, 0, 7, 142, 205, 106, 0, 0, 5, 155, 73, 68, 65, 84, 120, 156, 237, 212, 193, 141, 28, 65, 12, 4, 193, 253, 200, 27, 89, 41, 199, 37, 7, 248, 105, 80, 188, 90, 130, 65, 132, 1, 131, 234, 196, 124, 254, 252, 250, 253, 157, 254, 126, 223, 197, 55, 177, 85, 211, 39, 254, 5, 158, 208, 86, 63, 70, 238, 15, 23, 223, 196, 86, 77, 114, 127, 184, 248, 38, 182, 106, 146, 251, 195, 197, 55, 177, 85, 147, 220, 31, 46, 190, 137, 173, 154, 228, 254, 112, 241, 77, 108, 213, 36, 247, 135, 139, 111, 98, 171, 38, 185, 63, 92, 124, 19, 91, 53, 201, 253, 225, 226, 155, 216, 170, 73, 238, 15, 23, 223, 196, 86, 77, 114, 127, 184, 248, 38, 182, 106, 146, 251, 195, 197, 55, 177, 85, 147, 220, 31, 46, 190, 137, 173, 154, 228, 254, 112, 241, 77, 108, 213, 36, 247, 135, 139, 111, 98, 171, 38, 185, 63, 92, 124, 19, 91, 53, 201, 253, 225, 226, 155, 216, 170, 73, 238, 15, 23, 223, 196, 86, 77, 114, 127, 184, 248, 38, 182, 106, 146, 251, 195, 197, 55, 177, 85, 147, 220, 31, 46, 190, 137, 173, 154, 228, 254, 112, 241, 77, 108, 213, 36, 247, 135, 139, 111, 98, 171, 38, 185, 63, 92, 124, 19, 91, 53, 201, 253, 225, 226, 155, 216, 170, 73, 238, 15, 23, 223, 196, 86, 77, 114, 127, 184, 248, 38, 182, 106, 146, 251, 195, 197, 55, 177, 85, 147, 220, 31, 46, 190, 137, 173, 154, 228, 254, 112, 241, 77, 108, 213, 36, 247, 135, 139, 111, 98, 171, 38, 185, 63, 92, 124, 19, 91, 53, 201, 253, 225, 226, 155, 216, 170, 73, 238, 15, 23, 223, 196, 86, 77, 114, 127, 184, 248, 38, 182, 106, 146, 251, 195, 197, 55, 177, 85, 147, 220, 31, 46, 190, 137, 173, 154, 228, 254, 112, 241, 77, 108, 213, 36, 247, 135, 139, 111, 98, 171, 38, 185, 63, 92, 124, 19, 91, 53, 201, 253, 225, 226, 155, 216, 170, 73, 238, 15, 23, 223, 196, 86, 77, 114, 127, 184, 248, 38, 182, 106, 146, 251, 195, 197, 55, 177, 85, 147, 220, 31, 46, 190, 137, 173, 154, 228, 254, 112, 241, 77, 108, 213, 36, 247, 135, 139, 111, 98, 171, 38, 185, 63, 92, 124, 19, 91, 53, 201, 253, 225, 226, 155, 216, 170, 233, 123, 115, 135, 255, 238, 147, 254, 11, 212, 23, 223, 133, 190, 116, 68, 197, 201, 157, 41, 233, 136, 138, 147, 59, 83, 210, 17, 21, 39, 119, 166, 164, 35, 42, 78, 238, 76, 73, 71, 84, 156, 220, 153, 146, 142, 168, 56, 185, 51, 37, 29, 81, 113, 114, 103, 74, 58, 162, 226, 228, 206, 148, 116, 68, 197, 201, 157, 41, 233, 136, 138, 147, 59, 83, 210, 17, 21, 39, 119, 166, 164, 35, 42, 78, 238, 76, 73, 71, 84, 156, 220, 153, 146, 142, 168, 56, 185, 51, 37, 29, 81, 113, 114, 103, 74, 58, 162, 226, 228, 206, 148, 116, 68, 197, 201, 157, 41, 233, 136, 138, 147, 59, 83, 210, 17, 21, 39, 119, 166, 164, 35, 42, 78, 238, 76, 73, 71, 84, 156, 220, 153, 146, 142, 168, 56, 185, 51, 37, 29, 81, 113, 114, 103, 74, 58, 162, 226, 228, 206, 148, 116, 68, 197, 201, 157, 41, 233, 136, 138, 147, 59, 83, 210, 17, 21, 39, 119, 166, 164, 35, 42, 78, 238, 76, 73, 71, 84, 156, 220, 153, 146, 142, 168, 56, 185, 51, 37, 29, 81, 113, 114, 103, 74, 58, 162, 226, 228, 206, 148, 116, 68, 197, 201, 157, 41, 233, 136, 138, 147, 59, 83, 210, 17, 21, 39, 119, 166, 164, 35, 42, 78, 238, 76, 73, 71, 84, 156, 220, 153, 146, 142, 168, 56, 185, 51, 37, 29, 81, 113, 114, 103, 74, 58, 162, 226, 228, 206, 148, 116, 68, 197, 201, 157, 41, 233, 136, 138, 147, 59, 83, 210, 17, 21, 39, 119, 166, 164, 35, 42, 78, 238, 76, 73, 71, 84, 156, 220, 153, 146, 142, 168, 56, 185, 51, 37, 29, 81, 113, 114, 103, 74, 58, 162, 226, 228, 206, 148, 116, 68, 197, 201, 157, 41, 233, 136, 138, 147, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 43, 185, 175, 127, 194, 248, 38, 139, 182, 146, 251, 250, 39, 140, 111, 178, 104, 171, 79, 124, 20, 248, 49, 114, 231, 16, 185, 115, 136, 220, 57, 68, 238, 28, 34, 119, 14, 145, 59, 135, 200, 157, 67, 228, 206, 33, 114, 231, 16, 185, 115, 136, 220, 57, 68, 238, 28, 34, 119, 14, 145, 59, 135, 200, 157, 67, 228, 206, 33, 114, 231, 16, 185, 115, 136, 220, 57, 68, 238, 28, 34, 119, 14, 145, 59, 135, 200, 157, 67, 228, 206, 33, 114, 231, 16, 185, 115, 136, 220, 57, 68, 238, 28, 34, 119, 14, 145, 59, 135, 200, 157, 67, 228, 206, 33, 114, 231, 16, 185, 115, 136, 220, 57, 68, 238, 28, 34, 119, 14, 145, 59, 135, 200, 157, 67, 228, 206, 33, 114, 231, 16, 185, 115, 136, 220, 57, 68, 238, 28, 34, 119, 14, 145, 59, 135, 200, 157, 67, 228, 206, 33, 114, 231, 16, 185, 115, 136, 220, 57, 68, 238, 28, 34, 119, 14, 145, 59, 135, 200, 157, 67, 228, 206, 33, 114, 231, 16, 185, 115, 136, 220, 57, 68, 238, 28, 34, 119, 14, 145, 59, 135, 200, 157, 67, 228, 206, 33, 114, 231, 16, 185, 115, 136, 220, 57, 68, 238, 28, 34, 119, 14, 145, 59, 135, 200, 157, 67, 228, 206, 33, 114, 231, 16, 185, 115, 136, 220, 57, 68, 238, 28, 34, 119, 14, 145, 59, 135, 200, 157, 67, 228, 206, 33, 114, 231, 16, 185, 115, 136, 220, 57, 68, 238, 28, 34, 119, 14, 145, 59, 135, 200, 157, 67, 228, 206, 33, 114, 231, 16, 185, 115, 136, 220, 57, 68, 238, 28, 34, 119, 14, 145, 59, 135, 200, 157, 67, 228, 206, 33, 114, 231, 16, 185, 115, 136, 220, 57, 228, 31, 180, 178, 179, 166, 176, 10, 250, 251, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130>>

    bin =
      Elixicon.initialize_image_struct("Timothy")
      |> Elixicon.pick_rgb
      |> Elixicon.construct_grid
      |> Elixicon.filter_odd_cells
      |> Elixicon.build_pixel_map
      |> Elixicon.render_image

    assert bin === image_binary
  end

  test "encode_image_base64 creates a valid Base64 image with mime type" do
    base64_image = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAD6CAIAAAAHjs1qAAAFm0lEQVR4nO3UwY0cQQwEwf3IG1kpxyUH+GlQvFqCQYQBg+rEfP78+v2d/n7fxTexVdMn/gWe0FY/Ru4PF9/EVk1yf7j4JrZqkvvDxTexVZPcHy6+ia2a5P5w8U1s1ST3h4tvYqsmuT9cfBNbNcn94eKb2KpJ7g8X38RWTXJ/uPgmtmqS+8PFN7FVk9wfLr6JrZrk/nDxTWzVJPeHi29iqya5P1x8E1s1yf3h4pvYqknuDxffxFZNcn+4+Ca2apL7w8U3sVWT3B8uvomtmuT+cPFNbNUk94eLb2KrJrk/XHwTWzXJ/eHim9iqSe4PF9/EVk1yf7j4JrZqkvvDxTexVZPcHy6+ia2a5P5w8U1s1ST3h4tvYqsmuT9cfBNbNcn94eKb2KpJ7g8X38RWTXJ/uPgmtmqS+8PFN7FVk9wfLr6JrZrk/nDxTWzVJPeHi29iqya5P1x8E1s1yf3h4pvYqknuDxffxFZNcn+4+Ca2apL7w8U3sVWT3B8uvomtmuT+cPFNbNUk94eLb2KrJrk/XHwTWzXJ/eHim9iq6Xtzh//uk/4L1Bffhb50RMXJnSnpiIqTO1PSERUnd6akIypO7kxJR1Sc3JmSjqg4uTMlHVFxcmdKOqLi5M6UdETFyZ0p6YiKkztT0hEVJ3empCMqTu5MSUdUnNyZko6oOLkzJR1RcXJnSjqi4uTOlHRExcmdKemIipM7U9IRFSd3pqQjKk7uTElHVJzcmZKOqDi5MyUdUXFyZ0o6ouLkzpR0RMXJnSnpiIqTO1PSERUnd6akIypO7kxJR1Sc3JmSjqg4uTMlHVFxcmdKOqLi5M6UdETFyZ0p6YiKkztT0hEVJ3empCMqTu5MSUdUnNyZko6oOLkzJR1RcXJnSjqi4uTOlHRExcmdKemIipM7U9IRFSd3pqQjKk7uTElHVJzcmZKOqDi5MyUdUXFyZ0o6ouLkzpR0RMXJnSnpiIqT+/onjG+yaCu5r3/C+CaLtpL7+ieMb7JoK7mvf8L4Jou2kvv6J4xvsmgrua9/wvgmi7aS+/onjG+yaCu5r3/C+CaLtpL7+ieMb7JoK7mvf8L4Jou2kvv6J4xvsmgrua9/wvgmi7aS+/onjG+yaCu5r3/C+CaLtpL7+ieMb7JoK7mvf8L4Jou2kvv6J4xvsmgrua9/wvgmi7aS+/onjG+yaCu5r3/C+CaLtpL7+ieMb7JoK7mvf8L4Jou2kvv6J4xvsmgrua9/wvgmi7aS+/onjG+yaCu5r3/C+CaLtpL7+ieMb7JoK7mvf8L4Jou2kvv6J4xvsmgrua9/wvgmi7aS+/onjG+yaCu5r3/C+CaLtpL7+ieMb7JoK7mvf8L4Jou2kvv6J4xvsmgrua9/wvgmi7aS+/onjG+yaCu5r3/C+CaLtpL7+ieMb7JoK7mvf8L4Jou2kvv6J4xvsmgrua9/wvgmi7aS+/onjG+yaCu5r3/C+CaLtpL7+ieMb7JoK7mvf8L4Jou2kvv6J4xvsmgrua9/wvgmi7aS+/onjG+yaKtPfBT4MXLnELlziNw5RO4cIncOkTuHyJ1D5M4hcucQuXOI3DlE7hwidw6RO4fInUPkziFy5xC5c4jcOUTuHCJ3DpE7h8idQ+TOIXLnELlziNw5RO4cIncOkTuHyJ1D5M4hcucQuXOI3DlE7hwidw6RO4fInUPkziFy5xC5c4jcOUTuHCJ3DpE7h8idQ+TOIXLnELlziNw5RO4cIncOkTuHyJ1D5M4hcucQuXOI3DlE7hwidw6RO4fInUPkziFy5xC5c4jcOUTuHCJ3DpE7h8idQ+TOIXLnELlziNw5RO4cIncOkTuHyJ1D5M4hcucQuXOI3DlE7hwidw6RO4fInUPkziFy5xC5c4jcOUTuHCJ3DpE7h8idQ+TOIXLnELlziNw55B+0srOmsAr6+wAAAABJRU5ErkJggg=="

    computed =
      Elixicon.initialize_image_struct("Timothy")
      |> Elixicon.pick_rgb
      |> Elixicon.construct_grid
      |> Elixicon.filter_odd_cells
      |> Elixicon.build_pixel_map
      |> Elixicon.render_image
      |> Elixicon.encode_image_base64

    assert computed === base64_image
  end
end
